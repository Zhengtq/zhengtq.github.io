<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="Billy&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Billy&#39;s Blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Billy&#39;s Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>Billy's Blog</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Billy's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Make It Simple</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/27/DEMO/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Billy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Billy's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/27/DEMO/" itemprop="url">< DEMO > My work and DEMO</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-05-27T11:24:52+08:00">
                2019-05-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/DEMO/" itemprop="url" rel="index">
                    <span itemprop="name">DEMO</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/27/DEMO/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/05/27/DEMO/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Blinking-DEMO"><a href="#Blinking-DEMO" class="headerlink" title="Blinking DEMO"></a>Blinking DEMO</h1><iframe src="//player.bilibili.com/player.html?aid=60687132&cid=105630299&page=4" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

<p>The blue number on the right top of the video is the number of blinking since starting detection.<br>For more details, you can check this <a href="https://zhengtq.github.io/2019/04/19/motion-blink-rnn/" target="_blank" rel="noopener">page</a>.</p>
<h1 id="FaceAntispoofing-RNN-Smooth-DEMO"><a href="#FaceAntispoofing-RNN-Smooth-DEMO" class="headerlink" title="FaceAntispoofing,  RNN Smooth DEMO"></a>FaceAntispoofing,  RNN Smooth DEMO</h1><iframe src="//player.bilibili.com/player.html?aid=60687132&cid=105630290&page=3" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

<p>The number behind the string “CNN” is the output of CNN model which is used to predict a face is whether fake or alive.<br>The number behind the string “RNN” is the output of RNN model which aims to smoth the final result fed by CNN model based on sequence.<br>The number behind the string “SE_NUM” is the number of sequence which is used by RNN model to smooth the final result.<br>For details of RNN, you can check this <a href="https://zhengtq.github.io/2019/01/05/tf-rnn-gru/" target="_blank" rel="noopener">page</a> .</p>
<h1 id="Face-Antispoofing-RNN-online-Training-DEMO"><a href="#Face-Antispoofing-RNN-online-Training-DEMO" class="headerlink" title="Face Antispoofing,  RNN online Training DEMO"></a>Face Antispoofing,  RNN online Training DEMO</h1><iframe src="//player.bilibili.com/player.html?aid=60687132&cid=105630282&page=2" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

<p>When white string “DO” is displayed on the top of the video, it meams that the RNN model just do the inference work without any training.<br>When white string “TRAIN_LIVE” is displayed on the top of the video, it meams that RNN model are trained online based on liveness samples.<br>When white string “TRAIN_ATTACK” is displayed on the top of the video, it meams that RNN model are trained online based on spoofing samples.<br>The number behind the string “CNN” is the output of RNN model which is used to predict a face is whether fake or alive.<br>The number behind the string “LOSS” is the current loss while training model online.<br>For details of RNN online training, you can check this <a href="https://zhengtq.github.io/2019/05/15/gru-bp1/" target="_blank" rel="noopener">page</a>  .</p>
<h1 id="RNN-based-lane-line-offset-detection-DEMO"><a href="#RNN-based-lane-line-offset-detection-DEMO" class="headerlink" title="RNN based lane line offset detection DEMO"></a>RNN based lane line offset detection DEMO</h1><iframe src="//player.bilibili.com/player.html?aid=60687132&cid=105630257&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

<p>The number on the bottom left of the video indicates the probability whether a car is about to changing a lane.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/27/linux-multi-thread/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Billy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Billy's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/27/linux-multi-thread/" itemprop="url">< Linux > A simple way to run program with mult-thread</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-27T16:33:08+08:00">
                2019-07-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/27/linux-multi-thread/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/07/27/linux-multi-thread/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Applicable-conditions"><a href="#Applicable-conditions" class="headerlink" title="Applicable conditions"></a>Applicable conditions</h1><p>If you want to deal with thousands of cases in a same way, you can use use this method to increase the processing speed.<br>For example, when you want to load millions of images and process them independently, you can apply this method which could accelerate your processing speed hugely,</p>
<h1 id="Firstly-just-write-a-bash-file"><a href="#Firstly-just-write-a-bash-file" class="headerlink" title="Firstly, just write a bash file"></a>Firstly, just write a bash file</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">start_num=0</span><br><span class="line">thread_num=8  <span class="comment">#How many thread do you want apply</span></span><br><span class="line">all_num=100000  <span class="comment">#How many samples do you want to deals</span></span><br><span class="line">step_num=$[all_num/thread_num]</span><br><span class="line">end_num=<span class="variable">$step_num</span></span><br><span class="line">all_num=$[all_num+step_num]</span><br><span class="line">gpu_num=0</span><br><span class="line">current_thread=0</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$all_num</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$&#123;your_directory&#125;</span>;  <span class="comment"># cd to the directory your program locate</span></span><br><span class="line"><span class="keyword">while</span> ((<span class="variable">$current_thread</span> &lt; <span class="variable">$thread_num</span>)) </span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">python demo.py  <span class="variable">$start_num</span> <span class="variable">$end_num</span>  &amp;  <span class="comment">#Your program with parameters</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$start_num</span> <span class="variable">$end_num</span> <span class="variable">$gpu_num</span></span><br><span class="line">start_num=$[start_num+step_num] </span><br><span class="line">end_num=$[start_num+step_num]</span><br><span class="line">current_thread=$[current_thread + 1]</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>In the code snippet above, I take running python script as an example. You can modify the ‘all_num’ parameter according to the number of sample you wan to deal with. One important thing to mention is that ‘&amp;’ could make your program running parallelly which is the most important keyword in this code snippet.</p>
<h1 id="Modify-your-program"><a href="#Modify-your-program" class="headerlink" title="Modify your program"></a>Modify your program</h1><p>You should modify your program in order to fit the bash code above. The below code snippet is a python version.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) == <span class="number">3</span>:</span><br><span class="line">        begin_num = int(sys.argv[<span class="number">1</span>])</span><br><span class="line">        end_num = int(sys.argv[<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        begin_num = <span class="number">0</span></span><br><span class="line">        end_num = float(<span class="string">"inf"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, item <span class="keyword">in</span> enumerate(all_items):</span><br><span class="line">        <span class="keyword">if</span> i &lt; begin_num:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> i &gt;= end_num:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">	your_process_fun()....</span><br></pre></td></tr></table></figure></p>
<p>The below code snippet is a C/C++ version.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> begin_num = <span class="number">0</span>, end_num = INT_MAX;</span><br><span class="line">    <span class="keyword">if</span> (argc == <span class="number">3</span>) &#123;</span><br><span class="line">        begin_num = atoi(argv[<span class="number">1</span>]);</span><br><span class="line">        end_num = atoi(argv[<span class="number">2</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> count_num = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (Condition) &#123;</span><br><span class="line">        count_num++;</span><br><span class="line">        <span class="keyword">if</span> (count_num &lt; begin_num) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (count_num &gt; end_num) <span class="keyword">break</span>;</span><br><span class="line">        your_process_fun()....</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/15/gru-bp1/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Billy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Billy's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/15/gru-bp1/" itemprop="url">< Deeplarning > Understand Backpropagation of RNN/GRU and Implement It in Pure Python---1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-05-15T16:08:56+08:00">
                2019-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Deeplearning/" itemprop="url" rel="index">
                    <span itemprop="name">Deeplearning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/15/gru-bp1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/05/15/gru-bp1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Understanding-GRU"><a href="#Understanding-GRU" class="headerlink" title="Understanding GRU"></a>Understanding GRU</h1><p>As we know, RNN has the disadvantage of gradient vanishing(gradient exploding).GRU is invented in order to prevent gradient vanishing, <strong>so it could encode the information from very early time. Similarly to residual structure in CNN, GRU(or LSTM) could be seen RNN with residual block. That is to say that former hidden state is identically added to the newly computed hidden state(with a gate)</strong>.<br>For more details about GRU structure, you could check my former <a href="https://zhengtq.github.io/2019/01/05/tf-rnn-gru/" target="_blank" rel="noopener">blog</a>.</p>
<p>#Forward Propagation of GRU<br>In this section, I will implement my pure python version of GRU forward propagation same to the implementation in TensorFlow.Talk is cheap, show you the code:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, prev_s, W,Wb,C,Cb, V, Vb)</span>:</span></span><br><span class="line">    self.x_prev_s = np.concatenate((x, prev_s), axis = <span class="number">0</span>)</span><br><span class="line">    self.hidden_mum = len(prev_s)</span><br><span class="line">    self.mulw = mulGate.forward(W, Wb,self.x_prev_s)</span><br><span class="line">    self.mulwsig = sig_act.forward(self.mulw) </span><br><span class="line"></span><br><span class="line">    self.r = self.mulwsig[:len(self.mulwsig)/<span class="number">2</span>]</span><br><span class="line">    self.u = self.mulwsig[len(self.mulwsig)/<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">    self.r_state = eltwise_mul.forward(self.r, prev_s)</span><br><span class="line">    self.x_r_state = np.concatenate((x, self.r_state), axis = <span class="number">0</span>)</span><br><span class="line">    self.x_r_state_mulc =mulGate.forward(C,Cb, self.x_r_state)</span><br><span class="line">    self.x_r_state_mulc_tan = tan_act.forward(self.x_r_state_mulc)</span><br><span class="line"></span><br><span class="line">    self.tmpadd1 = eltwise_mul.forward(self.u, prev_s)</span><br><span class="line">    self.u_fu = <span class="number">1</span> - self.u</span><br><span class="line">    self.tmpadd2 = eltwise_mul.forward(self.u_fu, self.x_r_state_mulc_tan)</span><br><span class="line">    self.s = addGate.forward(self.tmpadd1, self.tmpadd2)</span><br><span class="line">    self.mulv = mulGate.forward(V,Vb, self.s)</span><br></pre></td></tr></table></figure></p>
<p>As you can see, we firstly concat ‘hpre’ and ‘x’ together, and then multiply with our first weigth ‘W’(Same to ‘hpre’ and ‘x’ seperatly multiply its weight and add together). <strong>Variable’r’ and ‘u’ are two gates. Gate ‘r’ controls how much hidden state infromation could be mixed with ‘x’. Gate ‘u’ controls how much hidden state information could be directly and identically flow to the next state</strong>.</p>
<p>#Back Propagation of GRU<br> As we know, RNN use <strong>back propagation through time(PBTT)</strong> to compute gradients for each weights. PBTT means the gradients should flow through time(reversely) which also means you should comput the gradient of hidden state at each time step and then feed back to the RNN block to furture compute gradients of the inner variables. The bellow code snippet is the gradient flow inner the GRU structure at one time step:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backward</span><span class="params">(self, x, prev_s, W, Wb, C, Cb, V, Vb,diff_s, dmulv)</span>:</span></span><br><span class="line"></span><br><span class="line">    dV,dVb, dsv = mulGate.backward(V,Vb, self.s, dmulv)</span><br><span class="line">    ds = dsv + diff_s</span><br><span class="line">    dtmpadd1, dtmpadd2 = addGate.backward(self.tmpadd1, self.tmpadd2, ds)</span><br><span class="line">    du_fu, dx_r_state_mulc_tan = eltwise_mul.backward(self.u_fu, self.x_r_state_mulc_tan, dtmpadd2)</span><br><span class="line">    du1 = -du_fu</span><br><span class="line">    </span><br><span class="line">    du2, dprev_s0 = eltwise_mul.backward(self.u, prev_s, dtmpadd1)</span><br><span class="line">    du = du1 + du2</span><br><span class="line">    dx_r_state_mulc = tan_act.backward(self.x_r_state_mulc, dx_r_state_mulc_tan)</span><br><span class="line">    dC,dCb, dx_x_r_state = mulGate.backward(C,Cb, self.x_r_state, dx_r_state_mulc)</span><br><span class="line">    dx = dx_x_r_state[:len(x)]</span><br><span class="line">    dr_state = dx_x_r_state[len(x):]</span><br><span class="line">   </span><br><span class="line">    dr, dprev_s1 = eltwise_mul.backward(self.r, prev_s, dr_state)</span><br><span class="line">    dmulwsig = np.concatenate((dr, du), axis = <span class="number">0</span>)</span><br><span class="line">    dmulw = sig_act.backward(self.mulw, dmulwsig)</span><br><span class="line">    dW,dWb, dx_prev_s = mulGate.backward(W, Wb, self.x_prev_s, dmulw)</span><br><span class="line">    dprev_s = dx_prev_s[-self.hidden_mum:] + dprev_s1 + dprev_s0</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (dprev_s, dW,dWb, dC,dCb, dV,dVb)</span><br></pre></td></tr></table></figure>
<p>Here I have admit that to write a back propagation algorithm is a fussy thing, for you should carefully compute the gradient flow through every operations without any error. There are some note for you. Firstly, while hidden state is used three times in the forward propagation(First branch: compute gate ‘r’ and gate ‘u’. Second branch: to mix information with input ‘x’. Third branch, identically add to the final hidden state), so you should add every gradient of hidden state computed from each branch<strong>(A way to prevent gradient vanishing)</strong>. Second thing to remember, feed your compute final gradient of hidden state to your last time step(or last layer of your model). </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/24/op-summary/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Billy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Billy's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/24/op-summary/" itemprop="url"><deeplarning> A simple way to distinguish different optimizers in DeepLearning</deeplarning></a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-24T16:58:01+08:00">
                2019-04-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Deeplearning/" itemprop="url" rel="index">
                    <span itemprop="name">Deeplearning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/04/24/op-summary/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/04/24/op-summary/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="The-optimizers"><a href="#The-optimizers" class="headerlink" title="The optimizers"></a>The optimizers</h1><p>Let’s simply list the optimizers that may or may not be used in your project.</p>
<ul>
<li>SGDOptimizer</li>
<li>MomentumOptimizer</li>
<li>NesterovOptimizer</li>
<li>AdagradOptimizer</li>
<li>AdadeltaOptimizer</li>
<li>RMSPropOptimizer</li>
<li>AdamOptimizer</li>
<li>NadamOptimizer</li>
</ul>
<h1 id="Four-type-of-these-optimizers"><a href="#Four-type-of-these-optimizers" class="headerlink" title="Four type of these optimizers"></a>Four type of these optimizers</h1><p>We can categorize these optimizers into Four types:</p>
<ul>
<li>Type1:  Base type(SGDOptimizer)</li>
<li>Type2: Add Momentum to gradient(Base on the historical gradient)(MomentumOptimizer, AdamOptimizer, NadamOptimizer)</li>
<li>Type3: Change LearningRate accordingly(According to the changing speed(second derivative of the gradient) of each variable)(AdagradOptimizer, Adadelta, RMSPropOptimizer, NadamOptimizer)</li>
<li>Type4: Change direction of the gradient(Weight firstly update by the historical gradient, and then compute the new gradient)(NesterovOptimizer, NadamOptimizer)</li>
</ul>
<h1 id="Let-make-some-equations"><a href="#Let-make-some-equations" class="headerlink" title="Let make some equations"></a>Let make some equations</h1><ul>
<li>SGDOptimizer = T1</li>
<li>MomentumOptimizer = T1 + T2</li>
<li>NesterovOptimizer = T1 + T4</li>
<li>AdagradOptimizer = T1 + T3</li>
<li>Adadelta = T1 + T3(Add window on the squared gradient)</li>
<li>RMSPropOptimizer = T1 + T3(Add window on the squared gradient)</li>
<li>AdamOptimizer = T1 + T3(Add window on the squared gradient  And add window on the gradient(momentum) itself)</li>
<li>NadamOptimizer = T1 + T3 + T4</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/19/motion-blink-rnn/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Billy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Billy's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/19/motion-blink-rnn/" itemprop="url">< Deeplearning > Use CNN and RNN to detect blink in a video</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-19T16:04:59+08:00">
                2019-04-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Deeplearning/" itemprop="url" rel="index">
                    <span itemprop="name">Deeplearning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/04/19/motion-blink-rnn/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/04/19/motion-blink-rnn/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Let’s-do-it"><a href="#Let’s-do-it" class="headerlink" title="Let’s do it!"></a>Let’s do it!</h1><p>If you use your face to pay a sum of money by ALIPAY, you may find that it requires you to do some facial movement to check you are a real person. So as you see, facial motion detection is interesting because it is acutally used in many circumstances. You may want to figure out how to detect facial motion. In this artical, I will take motion blink as a example to demenstion how to do it. So Let’s do it.</p>
<h1 id="How-to-‘make’-data-if-you-do-not-have"><a href="#How-to-‘make’-data-if-you-do-not-have" class="headerlink" title="How to ‘make’ data if you do not have"></a>How to ‘make’ data if you do not have</h1><p>Of course we can use thousands of blinking video sequences to train a RNN classifier. But it may be difficult yet inefficient to collect blink video. So how to simulate blinking data by using single eye image.<br>As everyone know, a blink sequence contains opening eye, closing eye and opening eye again. We can modeling blink motion as a sequence of eye opening and eye closing. So even you have just 100 opening eye images and 100 closing eye images, you can creats millions of eye blinking sequence. Quite surprising!</p>
<h1 id="Build-your-blinking-detection-system"><a href="#Build-your-blinking-detection-system" class="headerlink" title="Build your blinking detection system ?"></a>Build your blinking detection system ?</h1><p>Is seems is over. The last step is to use a RNN model to train a blink detection model by using the above fake training sequece. If you have read my former <a href="https://zhengtq.github.io/2019/01/05/tf-rnn-gru/" target="_blank" rel="noopener">post</a> , you may understand how GRU works in tensorflow. So we will start from here to demonstrate you how to detect blink based on GRU. Of course you can use conv-gru to simply use raw eye imaga sequence to get a end-to-end blink detection system.<br>However if you want to make the task simple, you can also firstly train a CNN binary classifier to classify if eye close or not. And then you can use the classifier as a feature extractor to extract feature of eye and then form a sequence as the input of your RNN network,</p>
<h1 id="To-make-the-system-more-accurate"><a href="#To-make-the-system-more-accurate" class="headerlink" title="To make the system more accurate."></a>To make the system more accurate.</h1><p>In order to make your blink system more accurate, to make the input feature to RNN more robust is very important. So you have to make sure you have trained a good CNN classifier. You can use facial landmarks(from any open source code) to get the landmarks of the face image and extract the eye part of the face image. One thing to be mentioned, you can use landmark points of the eye as parts of the whole input feature(combined with the feature extracted from you CNN classifier) to make the feature more robust.<br>Next, you have to figure out to make simulate a good sequence to train your RNN model. You can create many “hard sequence”  and do not neglect any blinking circumstances. One thing to be remembered, the more diverse your training sequence is, the more accurate your blink system is.</p>
<h1 id="Is-not-over"><a href="#Is-not-over" class="headerlink" title="Is not over."></a>Is not over.</h1><p>So now we have a simple eye blinking detection system. But there are many other questions should be answered. There first question is how many frame could be used to detection blink. The answer is quite simple: as many as you like. So in order to do this, you may train a RNN model based on variable length sequence(We have to define the max sequence length).  Another question is how do you design your actual system logic when you apply your model on real time video stream. And just leave the second question to you.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/head.png" alt="Billy">
            
              <p class="site-author-name" itemprop="name">Billy</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Zhengtq" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:ztqstd@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://zhengtq.github.io/2019/05/27/DEMO/" target="_blank" title="DEMO">
                      
                        <i class="fa fa-fw fa-angle-right"></i>DEMO</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Friends
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.cnblogs.com/zjutzz" title="ChrisZZ" target="_blank">ChrisZZ</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Billy</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      p
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      p
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'BGzxkVpRtr5PoQUppRDqiC1V-gzGzoHsz',
        appKey: 'K9tU9mVpjknHh8SNOWrqXqDV',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  

</body>
</html>
